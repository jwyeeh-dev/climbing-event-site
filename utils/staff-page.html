<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÍµêÎ•òÏ†Ñ ÌåÄÎ≥Ñ Ï†êÏàò ÏûÖÎ†•</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-slate-100 min-h-screen py-10">

  <h1 class="text-3xl font-bold text-center mb-8">ü§∏ ÍµêÎ•òÏ†Ñ Ï†êÏàò ÏûÖÎ†•</h1>

  <div x-data="scoreApp()" class="max-w-5xl mx-auto space-y-10">

    <!-- 6Í∞ú Ï°∞ Î∞òÎ≥µ -->
    <template x-for="team in teams" :key="team.id">
      <section class="bg-white rounded-2xl shadow p-6">

        <!-- Ï°∞ Ìó§Îçî -->
        <header class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold" x-text="team.name + 'Ï°∞'"></h2>
          <span class="text-lg font-bold text-blue-600" x-text="team.total + 'Ï†ê'"></span>
        </header>

        <!-- Ï°∞Ïõê ÏûÖÎ†• ÌÖåÏù¥Î∏î -->
        <div class="overflow-x-auto">
          <table class="w-full text-center text-sm">
            <thead class="bg-slate-200">
              <tr>
                <th class="py-2 px-2">Ï°∞Ïõê</th>
                <template x-for="i in 3">
                  <th class="py-2 px-2" x-text="'Î¨∏Ï†ú ' + i"></th>
                </template>
                <th class="py-2 px-2">Ìï©Í≥Ñ</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="member in team.members" :key="member.id">
                <tr class="even:bg-slate-50">
                  <!-- Ïù¥Î¶Ñ -->
                  <td class="py-2 px-2 font-medium" x-text="member.name"></td>

                  <!-- ÏãúÎèÑ Í≤∞Í≥º ÏûÖÎ†• -->
                  <template x-for="prob in member.problems">
                    <td class="py-2 px-2">
                      <select
                        x-model.number="prob.try"
                        @change="$dispatch('recalc')"
                        class="border rounded px-1 py-0.5 text-sm">
                        <option :value="0">Ïã§Ìå®</option>
                        <option :value="1">1Ìä∏</option>
                        <option :value="2">2Ìä∏</option>
                        <option :value="3">3Ìä∏</option>
                      </select>
                    </td>
                  </template>

                  <!-- Í∞úÏù∏ Ìï©Í≥Ñ -->
                  <td class="py-2 px-2 font-semibold" x-text="member.total"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>
    </template>

    <!-- Ï†ÑÏ≤¥ Ïû¨Í≥ÑÏÇ∞ Î≤ÑÌäº -->
    <div class="text-center">
      <button
        class="bg-orange-600 hover:bg-orange-700 text-white font-semibold px-6 py-2 rounded-lg shadow"
        @click="recalculateAll">
        Ï†ÑÏ≤¥ Ìï©Í≥Ñ Îã§Ïãú Í≥ÑÏÇ∞
      </button>
    </div>
  </div>

  <!-- Alpine Ïª¥Ìè¨ÎÑåÌä∏ -->
  <script>
    function scoreApp () {
      // Ï†êÏàò Îß§Ìïë: ÏãúÎèÑ->Ï†ê
      const scoreMap = {1: 3, 2: 2, 3: 1, 0: 0};

      return {
        // 6Í∞ú Ï°∞ & 3Î™Ö¬∑3Î¨∏Ï†ú Ï¥àÍ∏∞Í∞í
        teams: Array.from({ length: 6 }, (_, t) => ({
          id: t + 1,
          name: t + 1,
          total: 0,
          members: ['A', 'B', 'C'].map((m, idx) => ({
            id: `${t}-${idx}`,
            name: `${m}Ï°∞Ïõê`,
            total: 0,
            problems: Array.from({ length: 3 }, () => ({ try: 0 }))
          }))
        })),

        // Í∞úÎ≥Ñ¬∑Ï†ÑÏ≤¥ Ï†êÏàò Ïû¨Í≥ÑÏÇ∞
        recalculateAll () {
          this.teams.forEach(team => {
            let teamSum = 0;
            team.members.forEach(mem => {
              mem.total = mem.problems.reduce((s, p) => s + scoreMap[p.try], 0);
              teamSum += mem.total;
            });
            team.total = teamSum;
          });
        },

        // Alpine init
        init () {
          this.$watch('teams', () => this.recalculateAll(), { deep: true });
          this.recalculateAll();
          // ‚Äòrecalc‚Äô Ïª§Ïä§ÌÖÄ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ (select Î≥ÄÍ≤Ω Ïãú)
          this.$el.addEventListener('recalc', () => this.recalculateAll());
        }
      };
    }
  </script>
</body>
</html>
